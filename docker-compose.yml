version: '3.8'\n\nservices:\n  directory-api:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: directory-listing-api\n    restart: unless-stopped\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - PORT=3000\n      - LOG_LEVEL=info\n    volumes:\n      # Mount host filesystem for directory listing\n      # SECURITY WARNING: This gives the container access to the host filesystem\n      # Only use in trusted environments and consider restricting access\n      - /:/host:ro  # Linux/macOS - mount root as read-only\n      # For Windows, uncomment the line below and comment the line above:\n      # - C:\\:/host:ro\n      \n      # Mount logs directory for persistent logging\n      - ./logs:/app/logs\n    networks:\n      - directory-api-network\n    healthcheck:\n      test: [\"CMD\", \"node\", \"-e\", \"require('http').get('http://localhost:3000/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) }).on('error', () => process.exit(1))\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # Optional: Add a reverse proxy for production\n  nginx:\n    image: nginx:alpine\n    container_name: directory-api-nginx\n    restart: unless-stopped\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n      # Add SSL certificates if needed\n      # - ./ssl:/etc/nginx/ssl:ro\n    depends_on:\n      - directory-api\n    networks:\n      - directory-api-network\n    profiles:\n      - production  # Only start with --profile production\n\nnetworks:\n  directory-api-network:\n    driver: bridge\n\nvolumes:\n  logs:\n    driver: local